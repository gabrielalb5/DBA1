CREATE DATABASE IF NOT EXISTS EMPRESA;
USE EMPRESA;

-- TABELA FUNCIONARIO
CREATE TABLE FUNCIONARIO (
    CPF VARCHAR(11) NOT NULL PRIMARY KEY,
    NOME VARCHAR(50) NOT NULL,
    SALARIO DECIMAL(8, 2) DEFAULT 0.0,
    DATANASC DATE,
    RUA VARCHAR(50),
    NUMERO INT,
    COMPL VARCHAR(20),
    BAIRRO VARCHAR(20),
    CIDADE VARCHAR(20),
    ESTADO CHAR(2),
    CEP CHAR(10),
	SEXO CHAR(1),
    DNUMERO INT CHECK (DNUMERO > 0)
);

-- TABELA DEPARTAMENTO
CREATE TABLE DEPARTAMENTO (
	DNUMERO INT NOT NULL,
	DNOME VARCHAR(20) NOT NULL, 
	CPFGERENTE VARCHAR(11),
	PRIMARY KEY (DNUMERO),
	FOREIGN KEY (CPFGERENTE) 
		REFERENCES FUNCIONARIO(CPF)
);

-- CHAVE ESTRANGEIRA DNUMERO EM FUNCIONARIO
ALTER TABLE FUNCIONARIO
	ADD FOREIGN KEY (DNUMERO)
		REFERENCES DEPARTAMENTO(DNUMERO);
		
-- TABELA PROJETO
CREATE TABLE PROJETO (
	PROJNUMERO INT NOT NULL AUTO_INCREMENT,
	PROJNOME VARCHAR(20) NOT NULL,
	PROJLOCAL VARCHAR(20),
	DNUMERO INT,
	PRIMARY KEY (PROJNUMERO),
	FOREIGN KEY (DNUMERO) 
		REFERENCES DEPARTAMENTO(DNUMERO)
);
		
-- TABELA ATRIBUCAO (RELACIONAMENTO N:M TRABALHA_EM)
CREATE TABLE ATRIBUICAO (
	CPF VARCHAR(11) NOT NULL,
	PROJNUMERO INT NOT NULL,
	HORAS INT,
	PRIMARY KEY (CPF, PROJNUMERO),
	FOREIGN KEY (CPF) 
		REFERENCES FUNCIONARIO(CPF),
	FOREIGN KEY (PROJNUMERO) 
		REFERENCES PROJETO(PROJNUMERO)
);
		
-- TABELA DEPTOLOCAL RESULTANTE DO MAPEAMENTO DE ATRIBUTO MULTIVALORADO
CREATE TABLE DEPTOLOCAL (
	DNUMERO INT NOT NULL,
	NOMELOCAL VARCHAR(20) NOT NULL,
	PRIMARY KEY (DNUMERO, NOMELOCAL), 
	FOREIGN KEY (DNUMERO)
		REFERENCES DEPARTAMENTO(DNUMERO)
);	

INSERT INTO FUNCIONARIO 
(CPF, NOME, SALARIO, DATANASC, RUA, NUMERO, COMPL, BAIRRO, CIDADE, ESTADO, CEP, SEXO)
VALUES 
('1234', 'João Silva', 3000, '1965-01-09', 'Rua das Flores', 751, NULL, 'Centro', 'São Paulo', 'SP', '12345-678', 'M'),
('3334', 'Fernando Wong', 4000, '1955-12-08', 'Rua da Lapa', 34, NULL, 'Mooca', 'São Paulo', 'SP', '12345-000', 'M'),
('9998', 'Alice Zelaya', 2500, '1968-01-19', 'Rua Souza Lima', 35, NULL, 'Jardins', 'Curitiba', 'PR', '98765-432','F'),
('9876', 'Jennifer Souza', 4300, '1941-06-20', 'Av. Arthur de Lima', 54, 'apto 102', 'Centro', 'Santo André', 'SP','77664-432', 'F'),
('6668', 'Ronaldo Lima', 3800, '1962-09-15', 'Rua Rebouças', 65, 'apto 109 bloco 1', 'Vila Maria', 'Piracicaba', 'SP', '33333-000','M'),
('4534', 'Joice Leite', 2500, '1972-07-31', 'Av. Lucas Obes', 74, NULL, 'Centro', 'São Paulo', 'SP', '12345-999', 'F'),
('9879', 'André Pereira', 2500, '1969-03-29', 'Av. Timbira', 35, 'apto 23', 'Mooca', 'São Paulo', 'SP', '12345-000', 'M'),
('8886', 'Jorge Brito', 5500, '1937-11-10', 'Rua do Horto', 35, 'apto 501', 'Jardins', 'São Paulo', 'SP', '12345-500', 'M');

INSERT INTO DEPARTAMENTO (DNOME, DNUMERO, CPFGERENTE)
VALUES
('Pesquisa', 5, '3334'),
('Administração', 4, '9876'),
('Matriz', 1, '8886');		

INSERT INTO DEPTOLOCAL
VALUES
(1, 'São Paulo'), 
(4, 'Mauá'),
(5, 'São Paulo'),  
(5, 'Itu'), 
(5, 'Santo André'); 

-- INSERINDO PROJETOS
INSERT INTO PROJETO (PROJNOME, PROJLOCAL, DNUMERO)
VALUES
('Produto X', 'Santo André', 5),
('Produto Y', 'Itu', 5),
('Produto Z', 'São Paulo', 5),
('Informatização', 'Mauá', 4),
('Reorganização', 'São Paulo', 1),
('Novos benefícios','Mauá', 4);

INSERT INTO ATRIBUICAO (CPF, PROJNUMERO, HORAS)
VALUES
('1234', 1, 5),
('1234', 2, 2),
('6668', 3, 2),
('4534', 1, 4),
('4534', 2, 3),
('3334', 2, 1),
('3334', 3, 5),
('3334', 4, 6),
('3334', 5, 1),
('9998', 6, 3),
('9998', 4, 4),
('9879', 4, 5),
('9879', 6, 3),
('9876', 6, 3),
('9876', 5, 1),
('8886', 5, 2);

-- ATRIBUINDO OS DEPARTAMENTOS DOS FUNCIONARIOS
UPDATE FUNCIONARIO SET DNUMERO = 5 
WHERE CPF = '1234';

UPDATE FUNCIONARIO SET DNUMERO = 5
WHERE CPF = '3334';

UPDATE FUNCIONARIO SET DNUMERO = 4
WHERE CPF = '9998';

UPDATE FUNCIONARIO SET DNUMERO = 4
WHERE CPF = '9876';

UPDATE FUNCIONARIO SET DNUMERO = 5
WHERE CPF = '6668';

UPDATE FUNCIONARIO SET DNUMERO = 5
WHERE CPF = '4534';

UPDATE FUNCIONARIO SET DNUMERO = 4
WHERE CPF = '9879';

UPDATE FUNCIONARIO SET DNUMERO = 1
WHERE CPF = '8886';